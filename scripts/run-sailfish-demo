#!/bin/bash

set -euo pipefail

just build_release --features until

nodes=${1:-5}

for (( i=0; i<$nodes; i++ )); do
    cmd=(RUST_LOG=sailfish=info,timeboost=info,sailfish_consensus=warn,cliquenet=warn,sailfish_rbc=info \
        target/release/sailfish
        --id $i
        --port $((8000 + $i))
        --rpc-port $((8800 + $i))
        --metrics-port $((9000 + $i))
        --keyset-file test-configs/local.json
        --tps 100
        --nodes $nodes
        --until 300
    )

    eval "${cmd[@]}" &
done

wait
