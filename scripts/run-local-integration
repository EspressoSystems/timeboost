#!/bin/bash

set -euox pipefail

if [ "${1:-debug}" = "release" ]; then
    just build_release
else
    just build
fi

for i in {0..4}; do
    echo "Starting node $i"

    NO_COLOR=1 RUST_LOG=sailfish=trace \
    ./target/${1:-debug}/timeboost \
        --id $i \
        --port $((8000 + i)) \
        --rpc-port $((8800 + i)) \
        --metrics-port $((9000 + i)) \
        --base local &> /tmp/${i}.log &
done

wait

